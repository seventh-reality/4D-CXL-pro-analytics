<!doctype html>
<html lang="en">
  <head>
    <title>Mispa CXL Pro - AR 3D Model</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Experience the Mispa CXL Pro in Augmented Reality (AR). View the 3D model, download brochures, and explore features.">
    <meta name="keywords" content="Mispa CXL Pro, 3D model, Augmented Reality, medical devices, brochures, diagnostics">
    <meta name="author" content="Agappe Diagnostics">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Mispa CXL Pro - AR 3D Model">
    <meta property="og:description" content="View the Mispa CXL Pro in AR, download brochures, and explore features.">
    <meta property="og:image" content="https://www.agappe.com/path-to-your-image.jpg">
    <meta property="og:url" content="https://www.agappe.com/mispa-cxl-pro">
    <meta property="og:type" content="website">

    <!-- Google Analytics (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YB6FWQS3VP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-YB6FWQS3VP'); // Replace with your Google Analytics Measurement ID
    </script>

    <!-- Microsoft Clarity (Heatmaps & User Behavior Tracking) -->
    <script>
      (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "qq1zz8zek6");
    </script>

    <!-- Styles -->
    <link type="text/css" href="./styles.css" rel="stylesheet"/>

    <!-- Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.0.1/model-viewer.min.js"></script>

    <!-- Chatbot Styles -->
    <style>
      .chat-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        padding: 10px;
      }

      .chat-box {
        height: 200px;
        overflow-y: auto;
        border-bottom: 1px solid #ddd;
        padding: 5px;
      }

      .chat-input {
        width: 100%;
        padding: 8px;
        border: none;
        border-radius: 5px;
        outline: none;
      }

      .send-btn {
        width: 100%;
        margin-top: 5px;
        padding: 8px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .send-btn:hover {
        background: #0056b3;
      }

      .animation-trigger {
        text-align: center;
        font-size: 14px;
        color: #666;
      }
    </style>
  </head>

  <body>
    <!-- 3D Model Viewer -->
    <model-viewer id="model" src="Wave.glb" ar ar-modes="webxr scene-viewer quick-look"
        camera-controls poster="loading.gif" shadow-intensity="0.88"
        shadow-softness="1" exposure="1" animation-name="Idle" autoplay>
      <div class="progress-bar hide" slot="progress-bar">
        <div class="update-bar"></div>
      </div>
      <button slot="ar-button" id="ar-button">View in 4D</button>
    </model-viewer>

    <!-- Chatbot Toggle Button -->
    <button id="toggle-chat" class="send-btn" onclick="toggleChat()">Toggle Chat</button>

    <!-- Chatbot Container -->
    <div class="chat-container" id="chat-container" style="display: none;">
      <div class="chat-box" id="chat-box"></div>
      <input type="text" id="user-input" class="chat-input" placeholder="Ask about Mispa CXL Pro..." />
      <button class="send-btn" onclick="sendMessage()">Ask</button>
      <div class="animation-trigger">✨ Model animates on user question ✨</div>
    </div>

    <!-- JavaScript for Chatbot & Animation -->
    <script>
      function toggleChat() {
        let chatContainer = document.getElementById("chat-container");
        chatContainer.style.display = chatContainer.style.display === "none" ? "block" : "none";
      }

      function sendMessage() {
        let userMessage = document.getElementById("user-input").value.trim();
        if (!userMessage) return;

        let chatBox = document.getElementById("chat-box");
        chatBox.innerHTML += `<p><b>You:</b> ${userMessage}</p>`;

        // Simulated bot response
        let botMessage = "Here's some information about Mispa CXL Pro!";
        chatBox.innerHTML += `<p><b>Bot:</b> ${botMessage}</p>`;

        // Google Analytics event tracking
        gtag('event', 'chat_interaction', {
          'event_category': 'Chatbot',
          'event_label': userMessage
        });

        // Microsoft Clarity event tracking
        clarity("set", "ChatbotInteraction", userMessage);

        // Get the 3D model
        let modelViewer = document.getElementById("model");

        // Reset animation before playing
        modelViewer.setAttribute("animation-name", "none");

        // Use a small delay before setting the animation to ensure reset works
        setTimeout(() => {
          modelViewer.setAttribute("animation-name", "wave"); // Change to your actual animation name
        }, 100);

        // Clear input field
        document.getElementById("user-input").value = "";

        // Auto-scroll chatbox
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    </script>
  </body>
</html>
